<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>捞鱼客公司员工排班表</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        body {
            padding: 20px;
            background-color: #f5f7fa;
            overflow-x: auto;
        }
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 25px;
        }
        h1 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 26px;
            color: #165dff;
        }
        h2 {
            text-align: center;
            margin: 30px 0 20px;
            font-size: 20px;
            border-bottom: 2px solid #165dff;
            padding-bottom: 10px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .month-select {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 15px;
        }
        #monthPicker {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-size: 15px;
        }
        .legend {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }
        .color-block {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }
        .color-morning {
            background-color: #4299e1;
        }
        .color-evening {
            background-color: #9f7aea;
        }
        .color-rest {
            background-color: #718096;
        }
        .btn-group {
            text-align: center;
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            opacity: 0.9;
        }
        .primary-btn {
            background-color: #165dff;
        }
        .save-btn {
            background-color: #48bb78;
        }
        .clear-btn {
            background-color: #e53e3e;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            table-layout: fixed;
        }
        th, td {
            padding: 12px 5px;
            text-align: center;
            border: 1px solid #dee2e6;
            font-size: 14px;
            white-space: nowrap; /* 强制日期在同一行显示 */
            overflow: hidden;
            text-overflow: ellipsis; /* 极端情况省略，优先保证同区域 */
        }
        th {
            background-color: #165dff;
            color: white;
            font-weight: 600;
            position: sticky;
            left: 0;
            z-index: 10;
        }
        th:first-child, td:first-child {
            width: 60px;
            z-index: 20;
        }
        th:nth-child(2), td:nth-child(2) {
            width: 120px;
            z-index: 20;
        }
        /* 核心优化：日期列宽度适配文字，确保同区域完整显示 */
        .date-th, .date-td {
            width: 85px;
            letter-spacing: 0.5px; /* 文字间距微调，更紧凑 */
        }
        .report-th, .report-td {
            width: 100px;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        tr:hover {
            background-color: #e8f4f8;
        }
        input {
            width: 100%;
            padding: 6px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            outline: none;
            text-align: center;
            font-size: 14px;
            border: none;
        }
        select {
            width: 100%;
            padding: 10px 5px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            outline: none;
            text-align: center;
            font-size: 14px;
            color: white;
            font-weight: 600;
            appearance: none;
            -webkit-appearance: none;
            border: none;
        }
        .status-morning {
            background-color: #4299e1;
        }
        .status-evening {
            background-color: #9f7aea;
        }
        .status-rest {
            background-color: #718096;
        }
        .report-container {
            display: block;
            margin-top: 30px;
        }
        /* 响应式适配，小屏幕仍保证日期同区域 */
        @media (max-width: 1400px) {
            .date-th, .date-td {
                width: 80px;
                font-size: 13px;
            }
            .report-th, .report-td {
                width: 90px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>捞鱼客公司员工排班表</h1>
        <div class="header">
            <div class="month-select">
                <label for="monthPicker">选择排班月份：</label>
                <input type="month" id="monthPicker" onchange="generateDateColumns()">
            </div>
        </div>
        <div class="legend">
            <div class="legend-item">
                <div class="color-block color-morning"></div>
                <span>早班</span>
            </div>
            <div class="legend-item">
                <div class="color-block color-evening"></div>
                <span>晚班</span>
            </div>
            <div class="legend-item">
                <div class="color-block color-rest"></div>
                <span>休息（默认）</span>
            </div>
        </div>
        <div class="btn-group">
            <button class="primary-btn" onclick="addEmployeeRow()">新增员工</button>
            <button class="primary-btn" onclick="resetTable()">重置排班表</button>
            <button class="save-btn" onclick="saveAttendanceData()">保存排班数据</button>
            <button class="primary-btn" onclick="loadAttendanceData()">读取保存数据</button>
            <button class="clear-btn" onclick="clearSavedData()">清空保存数据</button>
        </div>
        <table id="monthlyAttendanceTable">
            <thead>
                <tr id="tableHeader">
                    <<<th>序号</</</th>
                    <<<th>员工姓名</</</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
        <div class="report-container" id="reportContainer">
            <h2 id="reportTitle"></h2>
            <table id="attendanceReportTable">
                <thead>
                    <tr>
                        <<<th class="report-th">序号</</</th>
                        <<<th class="report-th">员工姓名</</</th>
                        <<<th class="report-th">早班天数</</</th>
                        <<<th class="report-th">晚班天数</</</th>
                        <<<th class="report-th">休息天数</</</th>
                        <<<th class="report-th">当月总计</</th>
                    </tr>
                </thead>
                <tbody id="reportTableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let currentYearMonth = '';
        let daysInMonth = 0;
        const STORAGE_KEY = 'laoyukeScheduleDateSameArea';

        // 页面初始化
        window.onload = function() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0');
            currentYearMonth = `${year}-${month}`;
            document.getElementById('monthPicker').value = currentYearMonth;
            document.getElementById('reportTitle').textContent = `捞鱼客公司${year}年${month}月排班汇总报表`;
            generateDateColumns();
            addEmployeeRow();
            updateMonthlyReport();
        };

        // 生成当月日期列，确保日期在同一区域显示
        function generateDateColumns() {
            currentYearMonth = document.getElementById('monthPicker').value;
            if (!currentYearMonth) return;

            const [year, month] = currentYearMonth.split('-').map(Number);
            daysInMonth = new Date(year, month, 0).getDate();
            const headerRow = document.getElementById('tableHeader');
            document.getElementById('reportTitle').textContent = `捞鱼客公司${year}年${month}月排班汇总报表`;

            // 清空所有非核心列
            const allTh = headerRow.querySelectorAll('th:not(:nth-child(1)):not(:nth-child(2))');
            allTh.forEach(th => th.remove());

            // 新增日期列标题，文字紧凑排列在同一区域
            for (let i = 1; i <= daysInMonth; i++) {
                const th = document.createElement('th');
                th.className = 'date-th';
                th.textContent = `${month}月${i}日`;
                headerRow.appendChild(th);
            }

            // 同步更新员工行
            const tbody = document.getElementById('tableBody');
            const employeeRows = tbody.querySelectorAll('tr');
            employeeRows.forEach((row) => {
                const allTd = row.querySelectorAll('td:not(:nth-child(1)):not(:nth-child(2))');
                allTd.forEach(td => td.remove());
                for (let i = 1; i <= daysInMonth; i++) {
                    const td = document.createElement('td');
                    td.className = 'date-td';
                    td.innerHTML = `
                        <select class="status-rest" onchange="updateMonthlyReport()">
                            <option value="morning" class="status-morning">早班</option>
                            <option value="evening" class="status-evening">晚班</option>
                            <option value="rest" class="status-rest" selected>休息</option>
                        </select>
                    `;
                    const select = td.querySelector('select');
                    select.addEventListener('change', function() {
                        this.className = this.value === 'morning' ? 'status-morning' : 
                                         this.value === 'evening' ? 'status-evening' : 'status-rest';
                    });
                    row.appendChild(td);
                }
            });
            updateMonthlyReport();
        }

        // 新增员工行
        function addEmployeeRow() {
            const tbody = document.getElementById('tableBody');
            const rowCount = tbody.rows.length + 1;
            const newRow = document.createElement('tr');

            newRow.innerHTML = `
                <td>${rowCount}</td>
                <td><input type="text" placeholder="输入员工姓名" oninput="updateMonthlyReport()"></td>
            `;

            for (let i = 1; i <= daysInMonth; i++) {
                const td = document.createElement('td');
                td.className = 'date-td';
                td.innerHTML = `
                    <select class="status-rest" onchange="updateMonthlyReport()">
                        <option value="morning" class="status-morning">早班</option>
                        <option value="evening" class="status-evening">晚班</option>
                        <option value="rest" class="status-rest" selected>休息</option>
                    </select>
                `;
                const select = td.querySelector('select');
                select.addEventListener('change', function() {
                    this.className = this.value === 'morning' ? 'status-morning' : 
                                     this.value === 'evening' ? 'status-evening' : 'status-rest';
                });
                newRow.appendChild(td);
            }

            tbody.appendChild(newRow);
            updateMonthlyReport();
        }

        // 重置排班表
        function resetTable() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            addEmployeeRow();
            updateMonthlyReport();
        }

        // 实时更新月度汇总报表
        function updateMonthlyReport() {
            const tbody = document.getElementById('tableBody');
            const employeeRows = tbody.querySelectorAll('tr');
            const reportTbody = document.getElementById('reportTableBody');
            reportTbody.innerHTML = '';

            employeeRows.forEach((row, index) => {
                const nameInput = row.querySelector('input');
                const name = nameInput.value.trim() || `员工${index + 1}`;
                const selects = row.querySelectorAll('select');
                let morningDays = 0, eveningDays = 0, restDays = 0;

                selects.forEach(select => {
                    const value = select.value;
                    if (value === 'morning') morningDays++;
                    else if (value === 'evening') eveningDays++;
                    else if (value === 'rest') restDays++;
                });

                const totalDays = morningDays + eveningDays + restDays;
                const reportRow = document.createElement('tr');
                reportRow.innerHTML = `
                    <td class="report-td">${index + 1}</td>
                    <td class="report-td">${name}</td>
                    <td class="report-td">${morningDays}</td>
                    <td class="report-td">${eveningDays}</td>
                    <td class="report-td">${restDays}</td>
                    <td class="report-td">${totalDays}</td>
                `;
                reportTbody.appendChild(reportRow);
            });
        }

        // 保存排班数据
        function saveAttendanceData() {
            const tbody = document.getElementById('tableBody');
            const employeeRows = tbody.querySelectorAll('tr');
            const attendanceData = {
                yearMonth: currentYearMonth,
                days: daysInMonth,
                employees: []
            };

            employeeRows.forEach((row, index) => {
                const nameInput = row.querySelector('input');
                const name = nameInput ? nameInput.value.trim() : `员工${index + 1}`;
                const selects = row.querySelectorAll('select');
                const statusList = [];
                selects.forEach(select => {
                    statusList.push(select.value);
                });
                attendanceData.employees.push({ index: index + 1, name, statusList });
            });

            localStorage.setItem(STORAGE_KEY, JSON.stringify(attendanceData));
            alert('排班数据保存成功！');
        }

        // 读取保存数据
        function loadAttendanceData() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (!savedData) {
                alert('暂无保存的排班数据！');
                return;
            }

            const attendanceData = JSON.parse(savedData);
            currentYearMonth = attendanceData.yearMonth;
            daysInMonth = attendanceData.days;

            document.getElementById('monthPicker').value = currentYearMonth;
            generateDateColumns();

            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            attendanceData.employees.forEach(emp => {
                const newRow = document.createElement('tr');
                newRow.innerHTML = `<td>${emp.index}</td><td><input type="text" value="${emp.name}" oninput="updateMonthlyReport()"></td>`;
                emp.statusList.forEach(status => {
                    const td = document.createElement('td');
                    td.className = 'date-td';
                    td.innerHTML = `
                        <select class="${status === 'morning' ? 'status-morning' : status === 'evening' ? 'status-evening' : 'status-rest'}" onchange="updateMonthlyReport()">
                            <option value="morning" ${status === 'morning' ? 'selected' : ''} class="status-morning">早班</option>
                            <option value="evening" ${status === 'evening' ? 'selected' : ''} class="status-evening">晚班</option>
                            <option value="rest" ${status === 'rest' ? 'selected' : ''} class="status-rest">休息</option>
                        </select>
                    `;
                    const select = td.querySelector('select');
                    select.addEventListener('change', function() {
                        this.className = this.value === 'morning' ? 'status-morning' : 
                                         this.value === 'evening' ? 'status-evening' : 'status-rest';
                    });
                    newRow.appendChild(td);
                });
                tbody.appendChild(newRow);
            });

            updateMonthlyReport();
            alert('排班数据读取成功！');
        }

        // 清空保存数据
        function clearSavedData() {
            if (confirm('确定要清空所有保存的排班数据吗？此操作不可恢复！')) {
                localStorage.removeItem(STORAGE_KEY);
                alert('保存的排班数据已清空！');
            }
        }
    </script>
</body>
</html>